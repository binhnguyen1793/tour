<?php
/**
 * Template for displaying single Tour post - Giao diện giống BestPrice
 */
get_header();
global $post;

// Lấy các trường từ ACF
$img           = get_field('anh_dai_dien_tour');
$gia           = get_field('gia_tour');
$thoi_gian     = get_field('thoi_gian');
$khoi_hanh     = get_field('khoi_hanh_tu');
$diem_den      = get_field('diem_den');
$phuong_tien   = get_field('phuong_tien');
$ma_tour       = get_field('ma_tour');
$lich_trinh    = get_field('lich_trinh');
$bao_gom       = get_field('bao_gom');
$khong_bao_gom = get_field('khong_bao_gom');
$chinh_sach    = get_field('chinh_sach');
$luu_y         = get_field('luu_y');

?>
<div class="tour-wrapper">
  <section class="tour-header">
    <h1><?php the_title(); ?></h1>
    <span class="rating">9.1 <span class="excellent">Tuyệt vời</span> - 2 đánh giá</span>
  </section>

  <section class="tour-content">
    <div class="tour-image">
      <?php if ($img): ?>
        <img src="<?php echo esc_url($img['url']); ?>" alt="<?php echo esc_attr(get_the_title()); ?>">
        <div class="promotion-banner">Tặng ngay Vali Cao Cấp 1,5 Triệu</div>
      <?php endif; ?>
    </div>
    <div class="tour-details">
      <p><strong><?php echo esc_html($thoi_gian); ?></strong></p>
      <p>Khởi hành từ <?php echo esc_html($khoi_hanh); ?></p>
      <p>Giá từ: <span class="price"><?php echo number_format($gia, 0, ',', '.'); ?>đ</span></p>
      <button class="book-btn">Gửi yêu cầu</button>
    </div>
  </section>

  <nav class="tour-tabs">
    <ul>
      <span class="tab" data-target="gioithieu">Giới thiệu</span>
      <span class="tab" data-target="lichtrinh">Lịch trình</span>
      <span class="tab" data-target="banggia">Bảng giá</span>
      <span class="tab" data-target="danhgia">Đánh giá</span>
      <span class="tab" data-target="hoidap">Hỏi đáp</span>
    </ul>
  </nav>

  <section class="tour-description" id="gioithieu">
    <div class="entry-content">
      <?php the_content(); ?>
    </div>
    <h2>📌 Điểm nổi bật</h2>
    <?php if (have_rows('diem_noi_bat')): ?>
      <ul>
        <?php while (have_rows('diem_noi_bat')): the_row(); ?>
          <li>✅ <?php the_sub_field('noi_dung'); ?></li>
        <?php endwhile; ?>
      </ul>
    <?php endif; ?>
  </section>

  <section id="lichtrinh">
    <h2>📍 Lịch trình tour</h2>
    <div class="itinerary">
      <?php if ($lich_trinh): $i = 1; foreach ($lich_trinh as $lt): ?>
        <div class="day">Ngày <?php echo $i++; ?>: <?php echo esc_html($lt['tieu_de']); ?></div>
        <div class="content"><?php echo esc_html($lt['noi_dung']); ?></div>
      <?php endforeach; else: ?>
        <p>Chưa có lịch trình.</p>
      <?php endif; ?>
    </div>
  </section>

  <section id="banggia">
    <h2>📌 Bảng giá (Khởi hành từ <?php echo esc_html($khoi_hanh); ?>)</h2>
    <?php get_template_part('template-parts/price-table'); ?>
  </section>

  <section id="hoidap">
    <h2>📌 Quy định dịch vụ</h2>
    <?php if ($bao_gom): ?>
      <div class="service-item"><span>✔ Giá bao gồm</span><span class="arrow">▼</span></div>
      <div class="service-content"><?php echo wp_kses_post($bao_gom); ?></div>
    <?php endif; ?>
    <?php if ($khong_bao_gom): ?>
      <div class="service-item"><span>🚫 Giá không bao gồm</span><span class="arrow">▼</span></div>
      <div class="service-content"><?php echo wp_kses_post($khong_bao_gom); ?></div>
    <?php endif; ?>
    <?php if ($chinh_sach): ?>
      <div class="service-item"><span>❌ Quy định huỷ/đổi đặt tour</span><span class="arrow">▼</span></div>
      <div class="service-content"><?php echo wp_kses_post($chinh_sach); ?></div>
    <?php endif; ?>
    <?php if ($luu_y): ?>
      <div class="service-item"><span style="color:red;">⚠ Lưu ý *</span><span class="arrow">▼</span></div>
      <div class="service-content"><?php echo wp_kses_post($luu_y); ?></div>
    <?php endif; ?>
  </section>

  <section id="danhgia">
    <h2>📌 Đánh giá</h2>
    <?php get_template_part('template-parts/reviews'); ?>
  </section>
</div>

<?php get_footer(); ?>
